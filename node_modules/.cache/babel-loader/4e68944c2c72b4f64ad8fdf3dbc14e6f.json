{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\Users\\\\HSE-KMS\\\\Documents\\\\temp\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\HSE-KMS\\\\Documents\\\\temp\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"C:\\\\Users\\\\HSE-KMS\\\\Documents\\\\temp\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"C:\\\\Users\\\\HSE-KMS\\\\Documents\\\\temp\\\\frontend\\\\src\\\\App.js\";\n\n/* eslint-disable react-hooks/exhaustive-deps */\nimport React, { useEffect, useState } from 'react';\nimport { withRouter } from 'react-router-dom';\nimport useStores from '@stores/useStores';\nimport { useObserver } from 'mobx-react-lite';\nimport LoginLayout from '@pages/layout/LoginLayout';\nimport MainLayout from '@pages/layout/MainLayout';\nimport ErrorLayout from '@pages/layout/ErrorLayout';\nimport { ThemeProvider } from '@material-ui/styles';\nimport { createMuiTheme } from '@material-ui/core/styles';\nimport { themeStyle } from '@styles/style';\nimport SecStorage from '@lib/secureStorage';\nimport axios from 'axios';\nimport '@root/App.scss';\nimport 'react-app-polyfill/ie11';\nimport 'react-app-polyfill/stable';\nvar THEME = createMuiTheme(themeStyle);\n\nvar App = function App(_ref) {\n  var location = _ref.location,\n      history = _ref.history;\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      view = _useState2[0],\n      setView = _useState2[1];\n\n  var _useStores = useStores(),\n      commonStore = _useStores.commonStore,\n      userStore = _useStores.userStore;\n\n  var _useObserver = useObserver(function () {\n    return {\n      $SetDim: commonStore.fSetDim,\n      $SetKey: userStore.fSetKey,\n      $SetUser: userStore.fSetUser,\n      $ClearUser: userStore.fClearUser\n    };\n  }),\n      $SetDim = _useObserver.$SetDim,\n      $SetKey = _useObserver.$SetKey,\n      $SetUser = _useObserver.$SetUser,\n      $ClearUser = _useObserver.$ClearUser;\n\n  useEffect(function () {\n    if (location.pathname === '/login' || location.pathname.startsWith('/error')) {\n      document.getElementById('root').classList.remove('BodyMain');\n    } else {\n      document.getElementById('root').classList.add('BodyMain');\n    }\n\n    if (location.pathname.startsWith('/error')) {\n      setView(true);\n    }\n  }, [location]);\n  useEffect(function () {\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var result1, secureStorage, user, result2, _secureStorage;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              window.addEventListener('resize', function () {\n                if (window.innerWidth > 570) {\n                  $SetDim(window.innerWidth / 1000);\n                } else {\n                  $SetDim(570 / 1000);\n                }\n              });\n              _context.next = 4;\n              return axios.get('/@/auth/store', {});\n\n            case 4:\n              result1 = _context.sent;\n\n              if (!result1.data) {\n                _context.next = 10;\n                break;\n              }\n\n              _context.next = 8;\n              return $SetKey(result1.data);\n\n            case 8:\n              _context.next = 12;\n              break;\n\n            case 10:\n              history.push('/error_500');\n              return _context.abrupt(\"return\");\n\n            case 12:\n              secureStorage = SecStorage(result1.data);\n              user = secureStorage.getItem('user_hansun');\n\n              if (user) {\n                _context.next = 17;\n                break;\n              }\n\n              setView(true);\n              return _context.abrupt(\"return\");\n\n            case 17:\n              _context.next = 19;\n              return $SetUser(JSON.parse(user));\n\n            case 19:\n              _context.next = 21;\n              return axios.get('/@/auth/check', {});\n\n            case 21:\n              result2 = _context.sent;\n\n              if (!(result2.statusText !== 'OK')) {\n                _context.next = 25;\n                break;\n              }\n\n              _context.next = 25;\n              return $ClearUser();\n\n            case 25:\n              setView(true);\n              _context.next = 35;\n              break;\n\n            case 28:\n              _context.prev = 28;\n              _context.t0 = _context[\"catch\"](0);\n              _context.next = 32;\n              return $ClearUser();\n\n            case 32:\n              _secureStorage = SecStorage();\n\n              _secureStorage.removeItem('user_hansun');\n\n              setView(true);\n\n            case 35:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 28]]);\n    }))();\n  }, []);\n  return React.createElement(React.Fragment, null, view && React.createElement(ThemeProvider, {\n    theme: THEME,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83\n    },\n    __self: this\n  }, function () {\n    switch (location.pathname) {\n      case '/login':\n        return React.createElement(LoginLayout, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 87\n          },\n          __self: this\n        });\n\n      default:\n        if (location.pathname.startsWith('/error')) {\n          return React.createElement(ErrorLayout, {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 90\n            },\n            __self: this\n          });\n        }\n\n        return React.createElement(MainLayout, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 92\n          },\n          __self: this\n        });\n    }\n  }()));\n};\n\nexport default withRouter(App);","map":{"version":3,"sources":["C:\\Users\\HSE-KMS\\Documents\\temp\\frontend\\src\\App.js"],"names":["React","useEffect","useState","withRouter","useStores","useObserver","LoginLayout","MainLayout","ErrorLayout","ThemeProvider","createMuiTheme","themeStyle","SecStorage","axios","THEME","App","location","history","view","setView","commonStore","userStore","$SetDim","fSetDim","$SetKey","fSetKey","$SetUser","fSetUser","$ClearUser","fClearUser","pathname","startsWith","document","getElementById","classList","remove","add","window","addEventListener","innerWidth","get","result1","data","push","secureStorage","user","getItem","JSON","parse","result2","statusText","removeItem"],"mappings":";;;;;AAAA;AACA,OAAOA,KAAP,IAAgBC,SAAhB,EAA2BC,QAA3B,QAA2C,OAA3C;AACA,SAASC,UAAT,QAA2B,kBAA3B;AACA,OAAOC,SAAP,MAAsB,mBAAtB;AACA,SAASC,WAAT,QAA4B,iBAA5B;AACA,OAAOC,WAAP,MAAwB,2BAAxB;AACA,OAAOC,UAAP,MAAuB,0BAAvB;AACA,OAAOC,WAAP,MAAwB,2BAAxB;AACA,SAASC,aAAT,QAA8B,qBAA9B;AACA,SAASC,cAAT,QAA+B,0BAA/B;AACA,SAASC,UAAT,QAA2B,eAA3B;AACA,OAAOC,UAAP,MAAuB,oBAAvB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AAEA,OAAO,gBAAP;AACA,OAAO,yBAAP;AACA,OAAO,2BAAP;AAEA,IAAMC,KAAK,GAAGJ,cAAc,CAACC,UAAD,CAA5B;;AAEA,IAAMI,GAAG,GAAG,SAANA,GAAM,OAA2B;AAAA,MAAxBC,QAAwB,QAAxBA,QAAwB;AAAA,MAAdC,OAAc,QAAdA,OAAc;;AAAA,kBACbf,QAAQ,CAAC,KAAD,CADK;AAAA;AAAA,MAC9BgB,IAD8B;AAAA,MACxBC,OADwB;;AAAA,mBAEFf,SAAS,EAFP;AAAA,MAE7BgB,WAF6B,cAE7BA,WAF6B;AAAA,MAEhBC,SAFgB,cAEhBA,SAFgB;;AAAA,qBAGchB,WAAW,CAAC;AAAA,WAAO;AACpEiB,MAAAA,OAAO,EAAEF,WAAW,CAACG,OAD+C;AAEpEC,MAAAA,OAAO,EAAEH,SAAS,CAACI,OAFiD;AAGpEC,MAAAA,QAAQ,EAAEL,SAAS,CAACM,QAHgD;AAIpEC,MAAAA,UAAU,EAAEP,SAAS,CAACQ;AAJ8C,KAAP;AAAA,GAAD,CAHzB;AAAA,MAG7BP,OAH6B,gBAG7BA,OAH6B;AAAA,MAGpBE,OAHoB,gBAGpBA,OAHoB;AAAA,MAGXE,QAHW,gBAGXA,QAHW;AAAA,MAGDE,UAHC,gBAGDA,UAHC;;AAUrC3B,EAAAA,SAAS,CAAC,YAAM;AACd,QAAIe,QAAQ,CAACc,QAAT,KAAsB,QAAtB,IAAkCd,QAAQ,CAACc,QAAT,CAAkBC,UAAlB,CAA6B,QAA7B,CAAtC,EAA8E;AAC5EC,MAAAA,QAAQ,CAACC,cAAT,CAAwB,MAAxB,EAAgCC,SAAhC,CAA0CC,MAA1C,CAAiD,UAAjD;AACD,KAFD,MAEO;AACLH,MAAAA,QAAQ,CAACC,cAAT,CAAwB,MAAxB,EAAgCC,SAAhC,CAA0CE,GAA1C,CAA8C,UAA9C;AACD;;AACD,QAAIpB,QAAQ,CAACc,QAAT,CAAkBC,UAAlB,CAA6B,QAA7B,CAAJ,EAA4C;AAC1CZ,MAAAA,OAAO,CAAC,IAAD,CAAP;AACD;AACF,GATQ,EASN,CAACH,QAAD,CATM,CAAT;AAWAf,EAAAA,SAAS,CAAC,YAAM;AACd;AAAA;AAAA,6BAAC;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEGoC,cAAAA,MAAM,CAACC,gBAAP,CAAwB,QAAxB,EAAkC,YAAM;AACtC,oBAAID,MAAM,CAACE,UAAP,GAAoB,GAAxB,EAA6B;AAC3BjB,kBAAAA,OAAO,CAACe,MAAM,CAACE,UAAP,GAAoB,IAArB,CAAP;AACD,iBAFD,MAEO;AACLjB,kBAAAA,OAAO,CAAC,MAAM,IAAP,CAAP;AACD;AACF,eAND;AAFH;AAAA,qBASuBT,KAAK,CAAC2B,GAAN,CAAU,eAAV,EAA2B,EAA3B,CATvB;;AAAA;AASOC,cAAAA,OATP;;AAAA,mBAUOA,OAAO,CAACC,IAVf;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAWWlB,OAAO,CAACiB,OAAO,CAACC,IAAT,CAXlB;;AAAA;AAAA;AAAA;;AAAA;AAaKzB,cAAAA,OAAO,CAAC0B,IAAR,CAAa,YAAb;AAbL;;AAAA;AAgBSC,cAAAA,aAhBT,GAgByBhC,UAAU,CAAC6B,OAAO,CAACC,IAAT,CAhBnC;AAiBSG,cAAAA,IAjBT,GAiBgBD,aAAa,CAACE,OAAd,CAAsB,aAAtB,CAjBhB;;AAAA,kBAkBQD,IAlBR;AAAA;AAAA;AAAA;;AAmBK1B,cAAAA,OAAO,CAAC,IAAD,CAAP;AAnBL;;AAAA;AAAA;AAAA,qBAsBSO,QAAQ,CAACqB,IAAI,CAACC,KAAL,CAAWH,IAAX,CAAD,CAtBjB;;AAAA;AAAA;AAAA,qBAuBuBhC,KAAK,CAAC2B,GAAN,CAAU,eAAV,EAA2B,EAA3B,CAvBvB;;AAAA;AAuBOS,cAAAA,OAvBP;;AAAA,oBAwBOA,OAAO,CAACC,UAAR,KAAuB,IAxB9B;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAyBWtB,UAAU,EAzBrB;;AAAA;AA2BGT,cAAAA,OAAO,CAAC,IAAD,CAAP;AA3BH;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,qBA6BSS,UAAU,EA7BnB;;AAAA;AA8BSgB,cAAAA,cA9BT,GA8ByBhC,UAAU,EA9BnC;;AA+BGgC,cAAAA,cAAa,CAACO,UAAd,CAAyB,aAAzB;;AACAhC,cAAAA,OAAO,CAAC,IAAD,CAAP;;AAhCH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAD;AAmCD,GApCQ,EAoCN,EApCM,CAAT;AAsCA,SACE,0CACGD,IAAI,IACH,oBAAC,aAAD;AAAe,IAAA,KAAK,EAAEJ,KAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACI,YAAM;AACN,YAAQE,QAAQ,CAACc,QAAjB;AACE,WAAK,QAAL;AACE,eAAO,oBAAC,WAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAAP;;AACF;AACE,YAAId,QAAQ,CAACc,QAAT,CAAkBC,UAAlB,CAA6B,QAA7B,CAAJ,EAA4C;AAC1C,iBAAO,oBAAC,WAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAAP;AACD;;AACD,eAAO,oBAAC,UAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAAP;AAPJ;AASD,GAVA,EADH,CAFJ,CADF;AAmBD,CA9ED;;AA+EA,eAAe5B,UAAU,CAACY,GAAD,CAAzB","sourcesContent":["/* eslint-disable react-hooks/exhaustive-deps */\nimport React, { useEffect, useState } from 'react';\nimport { withRouter } from 'react-router-dom';\nimport useStores from '@stores/useStores';\nimport { useObserver } from 'mobx-react-lite';\nimport LoginLayout from '@pages/layout/LoginLayout';\nimport MainLayout from '@pages/layout/MainLayout';\nimport ErrorLayout from '@pages/layout/ErrorLayout';\nimport { ThemeProvider } from '@material-ui/styles';\nimport { createMuiTheme } from '@material-ui/core/styles';\nimport { themeStyle } from '@styles/style';\nimport SecStorage from '@lib/secureStorage';\nimport axios from 'axios';\n\nimport '@root/App.scss';\nimport 'react-app-polyfill/ie11';\nimport 'react-app-polyfill/stable';\n\nconst THEME = createMuiTheme(themeStyle);\n\nconst App = ({ location, history }) => {\n  const [view, setView] = useState(false);\n  const { commonStore, userStore } = useStores();\n  const { $SetDim, $SetKey, $SetUser, $ClearUser } = useObserver(() => ({\n    $SetDim: commonStore.fSetDim,\n    $SetKey: userStore.fSetKey,\n    $SetUser: userStore.fSetUser,\n    $ClearUser: userStore.fClearUser,\n  }));\n\n  useEffect(() => {\n    if (location.pathname === '/login' || location.pathname.startsWith('/error')) {\n      document.getElementById('root').classList.remove('BodyMain');\n    } else {\n      document.getElementById('root').classList.add('BodyMain');\n    }\n    if (location.pathname.startsWith('/error')) {\n      setView(true);\n    }\n  }, [location]);\n\n  useEffect(() => {\n    (async () => {\n      try {\n        window.addEventListener('resize', () => {\n          if (window.innerWidth > 570) {\n            $SetDim(window.innerWidth / 1000);\n          } else {\n            $SetDim(570 / 1000);\n          }\n        });\n        let result1 = await axios.get('/@/auth/store', {});\n        if (result1.data) {\n          await $SetKey(result1.data);\n        } else {\n          history.push('/error_500');\n          return;\n        }\n        const secureStorage = SecStorage(result1.data);\n        const user = secureStorage.getItem('user_hansun');\n        if (!user) {\n          setView(true);\n          return;\n        }\n        await $SetUser(JSON.parse(user));\n        let result2 = await axios.get('/@/auth/check', {});\n        if (result2.statusText !== 'OK') {\n          await $ClearUser();\n        }\n        setView(true);\n      } catch (e) {\n        await $ClearUser();\n        const secureStorage = SecStorage();\n        secureStorage.removeItem('user_hansun');\n        setView(true);\n      }\n    })();\n  }, []);\n\n  return (\n    <>\n      {view && (\n        <ThemeProvider theme={THEME}>\n          {(() => {\n            switch (location.pathname) {\n              case '/login':\n                return <LoginLayout />;\n              default:\n                if (location.pathname.startsWith('/error')) {\n                  return <ErrorLayout />;\n                }\n                return <MainLayout />;\n            }\n          })()}\n        </ThemeProvider>\n      )}\n    </>\n  );\n};\nexport default withRouter(App);\n"]},"metadata":{},"sourceType":"module"}